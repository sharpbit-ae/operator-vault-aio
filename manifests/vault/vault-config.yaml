apiVersion: v1
kind: ConfigMap
metadata:
  name: vault-config
  namespace: vault-aio
data:
  vault.hcl: |
    ui = true

    listener "tcp" {
      address = "0.0.0.0:8200"
      tls_disable = true  # TLS handled by ingress
      telemetry {
        unauthenticated_metrics_access = true
      }
    }

    storage "file" {
      path = "/vault/data"
    }

    # Prometheus metrics
    telemetry {
      prometheus_retention_time = "30s"
      disable_hostname = true
    }

    # Audit logging to stdout (captured by Alloy)
    audit {
      type = "file"
      path = "stdout"
      options = {
        log_raw = false
      }
    }

    api_addr = "http://vault:8200"
    cluster_addr = "http://vault:8201"

    # Disable mlock for container environments
    disable_mlock = true
