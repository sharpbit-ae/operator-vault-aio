apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards-overview
  namespace: vault-aio
  labels:
    grafana_dashboard: "1"
data:
  overview-main.json: |
    {
      "annotations": {"list": []},
      "editable": true,
      "id": null,
      "links": [],
      "templating": {
        "list": [
          {
            "current": {"selected": true, "text": "All", "value": "$__all"},
            "datasource": {"type": "prometheus", "uid": "prometheus"},
            "definition": "label_values(up, job)",
            "hide": 0,
            "includeAll": true,
            "multi": true,
            "name": "service",
            "options": [],
            "query": {"query": "label_values(up, job)", "refId": "StandardVariableQuery"},
            "refresh": 2,
            "regex": "",
            "sort": 1,
            "type": "query"
          },
          {
            "current": {"selected": false, "text": "All", "value": "$__all"},
            "datasource": {"type": "loki", "uid": "loki"},
            "definition": "label_values({namespace=\"vault-aio\"}, pod)",
            "hide": 0,
            "includeAll": true,
            "multi": true,
            "name": "pod",
            "options": [],
            "query": {"query": "label_values({namespace=\"vault-aio\"}, pod)", "refId": "StandardVariableQuery"},
            "refresh": 2,
            "regex": "",
            "sort": 1,
            "type": "query"
          },
          {
            "current": {"selected": false, "text": "error", "value": "error"},
            "hide": 0,
            "includeAll": true,
            "multi": true,
            "name": "log_level",
            "options": [
              {"selected": false, "text": "All", "value": "$__all"},
              {"selected": true, "text": "error", "value": "error"},
              {"selected": false, "text": "warn", "value": "warn"},
              {"selected": false, "text": "info", "value": "info"},
              {"selected": false, "text": "debug", "value": "debug"}
            ],
            "query": "error,warn,info,debug",
            "type": "custom"
          }
        ]
      },
      "panels": [
        {"gridPos": {"h": 2, "w": 24, "x": 0, "y": 0}, "id": 100, "options": {"content": "# Vault AIO Overview\nComplete status of VM, Kubernetes cluster, and all applications | **Filters:** Service: $service | Pod: $pod | Log Level: $log_level", "mode": "markdown"}, "title": "", "transparent": true, "type": "text"},
    
        {"gridPos": {"h": 1, "w": 24, "x": 0, "y": 2}, "id": 200, "title": "Host VM Status", "type": "row"},
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [{"options": {"1": {"text": "ONLINE", "color": "green"}, "0": {"text": "OFFLINE", "color": "red"}}, "type": "value"}], "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "green", "value": 1}]}}},
          "gridPos": {"h": 3, "w": 2, "x": 0, "y": 3},
          "id": 1,
          "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "up{job=\"integrations/unix\"}", "refId": "A"}],
          "title": "VM",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 70}, {"color": "red", "value": 85}]}, "unit": "percent", "max": 100, "min": 0}},
          "gridPos": {"h": 3, "w": 2, "x": 2, "y": 3},
          "id": 2,
          "options": {"colorMode": "background", "graphMode": "area", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "100 - (avg(irate(node_cpu_seconds_total{job=\"integrations/unix\",mode=\"idle\"}[5m])) * 100)", "refId": "A"}],
          "title": "CPU",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 70}, {"color": "red", "value": 85}]}, "unit": "percent", "max": 100, "min": 0}},
          "gridPos": {"h": 3, "w": 2, "x": 4, "y": 3},
          "id": 3,
          "options": {"colorMode": "background", "graphMode": "area", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "100 * (1 - (node_memory_MemAvailable_bytes{job=\"integrations/unix\"} / node_memory_MemTotal_bytes{job=\"integrations/unix\"}))", "refId": "A"}],
          "title": "Memory",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 70}, {"color": "red", "value": 85}]}, "unit": "percent", "max": 100, "min": 0}},
          "gridPos": {"h": 3, "w": 2, "x": 6, "y": 3},
          "id": 4,
          "options": {"colorMode": "background", "graphMode": "area", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "100 - ((node_filesystem_avail_bytes{job=\"integrations/unix\",fstype=~\"ext4|xfs|btrfs\"} * 100) / node_filesystem_size_bytes{job=\"integrations/unix\",fstype=~\"ext4|xfs|btrfs\"})", "refId": "A"}],
          "title": "Disk",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "decbytes"}},
          "gridPos": {"h": 3, "w": 2, "x": 8, "y": 3},
          "id": 5,
          "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "node_memory_MemTotal_bytes{job=\"integrations/unix\"}", "refId": "A"}],
          "title": "RAM",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "decbytes"}},
          "gridPos": {"h": 3, "w": 2, "x": 10, "y": 3},
          "id": 55,
          "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "node_filesystem_size_bytes{job=\"integrations/unix\",fstype=~\"ext4|xfs|btrfs\"}", "refId": "A"}],
          "title": "Disk Size",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "dtdurations"}},
          "gridPos": {"h": 3, "w": 2, "x": 12, "y": 3},
          "id": 6,
          "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "node_time_seconds{job=\"integrations/unix\"} - node_boot_time_seconds{job=\"integrations/unix\"}", "refId": "A"}],
          "title": "Uptime",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "Bps"}},
          "gridPos": {"h": 3, "w": 2, "x": 14, "y": 3},
          "id": 7,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "sum(rate(node_network_receive_bytes_total{job=\"integrations/unix\",device!~\"lo|veth.*|docker.*|br.*|cni.*|flannel.*\"}[5m]))", "refId": "A"}],
          "title": "Net In",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "Bps"}},
          "gridPos": {"h": 3, "w": 2, "x": 16, "y": 3},
          "id": 8,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "sum(rate(node_network_transmit_bytes_total{job=\"integrations/unix\",device!~\"lo|veth.*|docker.*|br.*|cni.*|flannel.*\"}[5m]))", "refId": "A"}],
          "title": "Net Out",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "Bps"}},
          "gridPos": {"h": 3, "w": 2, "x": 18, "y": 3},
          "id": 56,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "sum(rate(node_disk_read_bytes_total{job=\"integrations/unix\"}[5m]))", "refId": "A"}],
          "title": "Disk Read",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "Bps"}},
          "gridPos": {"h": 3, "w": 2, "x": 20, "y": 3},
          "id": 57,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "sum(rate(node_disk_written_bytes_total{job=\"integrations/unix\"}[5m]))", "refId": "A"}],
          "title": "Disk Write",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}},
          "gridPos": {"h": 3, "w": 2, "x": 22, "y": 3},
          "id": 58,
          "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "node_load1{job=\"integrations/unix\"}", "refId": "A"}],
          "title": "Load 1m",
          "type": "stat"
        },
    
        {"gridPos": {"h": 1, "w": 24, "x": 0, "y": 6}, "id": 201, "title": "Kubernetes Cluster", "type": "row"},
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}},
          "gridPos": {"h": 3, "w": 2, "x": 0, "y": 7},
          "id": 10,
          "options": {"colorMode": "value", "graphMode": "none", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "count(up)", "refId": "A"}],
          "title": "Targets",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}},
          "gridPos": {"h": 3, "w": 2, "x": 2, "y": 7},
          "id": 11,
          "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "count(up == 1)", "refId": "A"}],
          "title": "Healthy",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 1}]}, "unit": "short"}},
          "gridPos": {"h": 3, "w": 2, "x": 4, "y": 7},
          "id": 12,
          "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "count(up == 0) or vector(0)", "refId": "A"}],
          "title": "Down",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 1}, {"color": "red", "value": 5}]}, "unit": "short"}},
          "gridPos": {"h": 3, "w": 2, "x": 6, "y": 7},
          "id": 13,
          "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "sum(ALERTS{alertstate=\"firing\"}) or vector(0)", "refId": "A"}],
          "title": "Alerts",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}},
          "gridPos": {"h": 3, "w": 2, "x": 8, "y": 7},
          "id": 14,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "prometheus_tsdb_head_series", "refId": "A"}],
          "title": "Series",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "ops"}},
          "gridPos": {"h": 3, "w": 2, "x": 10, "y": 7},
          "id": 15,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "rate(prometheus_tsdb_head_samples_appended_total[5m])", "refId": "A"}],
          "title": "Samples/s",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "ops"}},
          "gridPos": {"h": 3, "w": 2, "x": 12, "y": 7},
          "id": 16,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "sum(rate(loki_distributor_lines_received_total[5m]))", "refId": "A"}],
          "title": "Logs/s",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "ops"}},
          "gridPos": {"h": 3, "w": 2, "x": 14, "y": 7},
          "id": 17,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "sum(rate(tempo_distributor_spans_received_total[5m]))", "refId": "A"}],
          "title": "Traces/s",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 1}, {"color": "red", "value": 3}]}, "unit": "short"}},
          "gridPos": {"h": 3, "w": 2, "x": 16, "y": 7},
          "id": 59,
          "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "sum(increase(kube_pod_container_status_restarts_total{namespace=\"vault-aio\"}[1h])) or vector(0)", "refId": "A"}],
          "title": "Restarts/1h",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "description": "Services that are currently DOWN",
          "fieldConfig": {
            "defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}]}},
            "overrides": []
          },
          "gridPos": {"h": 3, "w": 6, "x": 18, "y": 7},
          "id": 60,
          "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "auto", "orientation": "horizontal", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "name"},
          "targets": [{"expr": "up == 0", "legendFormat": "{{job}}", "refId": "A"}],
          "title": "Down Services",
          "type": "stat"
        },
    
        {"gridPos": {"h": 1, "w": 24, "x": 0, "y": 10}, "id": 202, "title": "Application Services", "type": "row"},
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "description": "Vault status: UNSEALED (green) = operational, SEALED (red) = needs unsealing",
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [{"options": {"0": {"text": "SEALED", "color": "red", "index": 0}, "1": {"text": "UNSEALED", "color": "green", "index": 1}}, "type": "value"}], "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "green", "value": 1}]}, "noValue": "NO DATA"}},
          "gridPos": {"h": 3, "w": 4, "x": 0, "y": 11},
          "id": 20,
          "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "clamp_max(clamp_min(vault_core_unsealed, 0), 1)", "refId": "A", "legendFormat": ""}],
          "title": "Vault",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [{"options": {"1": {"text": "UP", "color": "green"}, "0": {"text": "DOWN", "color": "red"}}, "type": "value"}], "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "green", "value": 1}]}, "noValue": "DOWN"}},
          "gridPos": {"h": 3, "w": 4, "x": 4, "y": 11},
          "id": 21,
          "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "up{job=\"prometheus\"}", "refId": "A"}],
          "title": "Prometheus",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [{"options": {"1": {"text": "UP", "color": "green"}, "0": {"text": "DOWN", "color": "red"}}, "type": "value"}], "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "green", "value": 1}]}, "noValue": "DOWN"}},
          "gridPos": {"h": 3, "w": 4, "x": 8, "y": 11},
          "id": 22,
          "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "up{job=\"grafana\"}", "refId": "A"}],
          "title": "Grafana",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [{"options": {"1": {"text": "UP", "color": "green"}, "0": {"text": "DOWN", "color": "red"}}, "type": "value"}], "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "green", "value": 1}]}, "noValue": "DOWN"}},
          "gridPos": {"h": 3, "w": 4, "x": 12, "y": 11},
          "id": 23,
          "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "up{job=\"loki\"}", "refId": "A"}],
          "title": "Loki",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [{"options": {"1": {"text": "UP", "color": "green"}, "0": {"text": "DOWN", "color": "red"}}, "type": "value"}], "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "green", "value": 1}]}, "noValue": "DOWN"}},
          "gridPos": {"h": 3, "w": 4, "x": 16, "y": 11},
          "id": 24,
          "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "up{job=\"tempo\"}", "refId": "A"}],
          "title": "Tempo",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [{"options": {"1": {"text": "UP", "color": "green"}, "0": {"text": "DOWN", "color": "red"}}, "type": "value"}], "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "green", "value": 1}]}, "noValue": "DOWN"}},
          "gridPos": {"h": 3, "w": 4, "x": 20, "y": 11},
          "id": 25,
          "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "center", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"]}, "textMode": "value"},
          "targets": [{"expr": "up{job=\"alertmanager\"}", "refId": "A"}],
          "title": "Alertmanager",
          "type": "stat"
        },
    
        {"gridPos": {"h": 1, "w": 24, "x": 0, "y": 14}, "id": 203, "title": "Resource Usage", "type": "row"},
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"drawStyle": "line", "fillOpacity": 20, "lineWidth": 1, "pointSize": 5, "showPoints": "never", "stacking": {"mode": "normal"}}, "unit": "bytes"}},
          "gridPos": {"h": 6, "w": 8, "x": 0, "y": 15},
          "id": 30,
          "targets": [
            {"expr": "process_resident_memory_bytes{job=\"vault\"}", "legendFormat": "Vault", "refId": "A"},
            {"expr": "process_resident_memory_bytes{job=\"prometheus\"}", "legendFormat": "Prometheus", "refId": "B"},
            {"expr": "process_resident_memory_bytes{job=\"loki\"}", "legendFormat": "Loki", "refId": "C"},
            {"expr": "process_resident_memory_bytes{job=\"tempo\"}", "legendFormat": "Tempo", "refId": "D"},
            {"expr": "process_resident_memory_bytes{job=\"alertmanager\"}", "legendFormat": "Alertmanager", "refId": "E"},
            {"expr": "process_resident_memory_bytes{job=\"grafana\"}", "legendFormat": "Grafana", "refId": "F"}
          ],
          "title": "Service Memory",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"drawStyle": "line", "fillOpacity": 10, "lineWidth": 1, "pointSize": 5, "showPoints": "never"}, "unit": "percentunit"}},
          "gridPos": {"h": 6, "w": 8, "x": 8, "y": 15},
          "id": 31,
          "targets": [
            {"expr": "rate(process_cpu_seconds_total{job=\"vault\"}[5m])", "legendFormat": "Vault", "refId": "A"},
            {"expr": "rate(process_cpu_seconds_total{job=\"prometheus\"}[5m])", "legendFormat": "Prometheus", "refId": "B"},
            {"expr": "rate(process_cpu_seconds_total{job=\"loki\"}[5m])", "legendFormat": "Loki", "refId": "C"},
            {"expr": "rate(process_cpu_seconds_total{job=\"tempo\"}[5m])", "legendFormat": "Tempo", "refId": "D"},
            {"expr": "rate(process_cpu_seconds_total{job=\"alertmanager\"}[5m])", "legendFormat": "Alertmanager", "refId": "E"},
            {"expr": "rate(process_cpu_seconds_total{job=\"grafana\"}[5m])", "legendFormat": "Grafana", "refId": "F"}
          ],
          "title": "Service CPU",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"drawStyle": "line", "fillOpacity": 10, "lineWidth": 1, "pointSize": 5, "showPoints": "never"}, "unit": "short"}},
          "gridPos": {"h": 6, "w": 8, "x": 16, "y": 15},
          "id": 61,
          "targets": [
            {"expr": "increase(kube_pod_container_status_restarts_total{namespace=\"vault-aio\"}[$__interval]) > 0", "legendFormat": "{{pod}}", "refId": "A"}
          ],
          "title": "Pod Restarts",
          "type": "timeseries"
        },
    
        {"gridPos": {"h": 1, "w": 24, "x": 0, "y": 21}, "id": 204, "title": "Errors by Service (filtered by: $pod)", "type": "row", "collapsed": false},
        {
          "datasource": {"type": "loki", "uid": "loki"},
          "description": "Error count per pod in the last hour",
          "fieldConfig": {
            "defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 10}, {"color": "red", "value": 50}]}, "unit": "short"},
            "overrides": []
          },
          "gridPos": {"h": 4, "w": 24, "x": 0, "y": 22},
          "id": 70,
          "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "auto", "orientation": "horizontal", "reduceOptions": {"calcs": ["sum"], "fields": "", "values": false}, "textMode": "value_and_name"},
          "targets": [{"expr": "sum by (pod) (count_over_time({namespace=\"vault-aio\", pod=~\"$pod\"} |~ \"(?i)(error|err|failed|failure|fatal|panic)\" [$__range]))", "legendFormat": "{{pod}}", "refId": "A"}],
          "title": "Errors by Pod (Total in Range)",
          "type": "stat"
        },
        {
          "datasource": {"type": "loki", "uid": "loki"},
          "description": "Warning count per pod in the last hour",
          "fieldConfig": {
            "defaults": {"color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 20}, {"color": "orange", "value": 100}]}, "unit": "short"},
            "overrides": []
          },
          "gridPos": {"h": 4, "w": 24, "x": 0, "y": 26},
          "id": 71,
          "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "auto", "orientation": "horizontal", "reduceOptions": {"calcs": ["sum"], "fields": "", "values": false}, "textMode": "value_and_name"},
          "targets": [{"expr": "sum by (pod) (count_over_time({namespace=\"vault-aio\", pod=~\"$pod\"} |~ \"(?i)(warn|warning)\" !~ \"(?i)(error|err|failed|failure|fatal|panic)\" [$__range]))", "legendFormat": "{{pod}}", "refId": "A"}],
          "title": "Warnings by Pod (Total in Range)",
          "type": "stat"
        },
    
        {"gridPos": {"h": 1, "w": 24, "x": 0, "y": 30}, "id": 205, "title": "Error Logs (filtered by: $pod, level: $log_level)", "type": "row", "collapsed": false},
        {
          "datasource": {"type": "loki", "uid": "loki"},
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 31},
          "id": 40,
          "options": {"dedupStrategy": "none", "enableLogDetails": true, "prettifyLogMessage": false, "showCommonLabels": false, "showLabels": true, "showTime": true, "sortOrder": "Descending", "wrapLogMessage": true},
          "targets": [{"expr": "{namespace=\"vault-aio\", pod=~\"$pod\"} |~ \"(?i)($log_level)\"", "refId": "A"}],
          "title": "Filtered Logs",
          "type": "logs"
        },
    
        {"gridPos": {"h": 1, "w": 24, "x": 0, "y": 39}, "id": 206, "title": "Troubleshooting", "type": "row", "collapsed": false},
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "description": "HTTP request latency for services",
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"drawStyle": "line", "fillOpacity": 10, "lineWidth": 1, "pointSize": 5, "showPoints": "never"}, "unit": "s"}},
          "gridPos": {"h": 6, "w": 8, "x": 0, "y": 40},
          "id": 80,
          "targets": [
            {"expr": "histogram_quantile(0.95, sum(rate(prometheus_http_request_duration_seconds_bucket[5m])) by (le))", "legendFormat": "Prometheus p95", "refId": "A"},
            {"expr": "histogram_quantile(0.95, sum(rate(loki_request_duration_seconds_bucket[5m])) by (le))", "legendFormat": "Loki p95", "refId": "B"}
          ],
          "title": "Request Latency (p95)",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "description": "Open file descriptors per service",
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"drawStyle": "line", "fillOpacity": 10, "lineWidth": 1, "pointSize": 5, "showPoints": "never"}, "unit": "short"}},
          "gridPos": {"h": 6, "w": 8, "x": 8, "y": 40},
          "id": 81,
          "targets": [
            {"expr": "process_open_fds{job=\"vault\"}", "legendFormat": "Vault", "refId": "A"},
            {"expr": "process_open_fds{job=\"prometheus\"}", "legendFormat": "Prometheus", "refId": "B"},
            {"expr": "process_open_fds{job=\"loki\"}", "legendFormat": "Loki", "refId": "C"},
            {"expr": "process_open_fds{job=\"tempo\"}", "legendFormat": "Tempo", "refId": "D"},
            {"expr": "process_open_fds{job=\"grafana\"}", "legendFormat": "Grafana", "refId": "F"}
          ],
          "title": "Open File Descriptors",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "description": "Goroutines per service (Go runtime)",
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"drawStyle": "line", "fillOpacity": 10, "lineWidth": 1, "pointSize": 5, "showPoints": "never"}, "unit": "short"}},
          "gridPos": {"h": 6, "w": 8, "x": 16, "y": 40},
          "id": 82,
          "targets": [
            {"expr": "go_goroutines{job=\"vault\"}", "legendFormat": "Vault", "refId": "A"},
            {"expr": "go_goroutines{job=\"prometheus\"}", "legendFormat": "Prometheus", "refId": "B"},
            {"expr": "go_goroutines{job=\"loki\"}", "legendFormat": "Loki", "refId": "C"},
            {"expr": "go_goroutines{job=\"tempo\"}", "legendFormat": "Tempo", "refId": "D"},
            {"expr": "go_goroutines{job=\"alertmanager\"}", "legendFormat": "Alertmanager", "refId": "E"}
          ],
          "title": "Goroutines",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "description": "Network errors and drops",
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"drawStyle": "line", "fillOpacity": 10, "lineWidth": 1, "pointSize": 5, "showPoints": "never"}, "unit": "short"}},
          "gridPos": {"h": 6, "w": 8, "x": 0, "y": 46},
          "id": 83,
          "targets": [
            {"expr": "rate(node_network_receive_errs_total{job=\"integrations/unix\"}[5m])", "legendFormat": "RX Errors {{device}}", "refId": "A"},
            {"expr": "rate(node_network_transmit_errs_total{job=\"integrations/unix\"}[5m])", "legendFormat": "TX Errors {{device}}", "refId": "B"},
            {"expr": "rate(node_network_receive_drop_total{job=\"integrations/unix\"}[5m])", "legendFormat": "RX Drops {{device}}", "refId": "C"},
            {"expr": "rate(node_network_transmit_drop_total{job=\"integrations/unix\"}[5m])", "legendFormat": "TX Drops {{device}}", "refId": "D"}
          ],
          "title": "Network Errors & Drops",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "description": "Disk I/O latency",
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"drawStyle": "line", "fillOpacity": 10, "lineWidth": 1, "pointSize": 5, "showPoints": "never"}, "unit": "s"}},
          "gridPos": {"h": 6, "w": 8, "x": 8, "y": 46},
          "id": 84,
          "targets": [
            {"expr": "rate(node_disk_read_time_seconds_total{job=\"integrations/unix\"}[5m]) / rate(node_disk_reads_completed_total{job=\"integrations/unix\"}[5m])", "legendFormat": "Read Latency {{device}}", "refId": "A"},
            {"expr": "rate(node_disk_write_time_seconds_total{job=\"integrations/unix\"}[5m]) / rate(node_disk_writes_completed_total{job=\"integrations/unix\"}[5m])", "legendFormat": "Write Latency {{device}}", "refId": "B"}
          ],
          "title": "Disk I/O Latency",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "description": "GC pause duration",
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"drawStyle": "line", "fillOpacity": 10, "lineWidth": 1, "pointSize": 5, "showPoints": "never"}, "unit": "s"}},
          "gridPos": {"h": 6, "w": 8, "x": 16, "y": 46},
          "id": 85,
          "targets": [
            {"expr": "go_gc_duration_seconds{job=\"vault\",quantile=\"0.75\"}", "legendFormat": "Vault p75", "refId": "A"},
            {"expr": "go_gc_duration_seconds{job=\"prometheus\",quantile=\"0.75\"}", "legendFormat": "Prometheus p75", "refId": "B"},
            {"expr": "go_gc_duration_seconds{job=\"loki\",quantile=\"0.75\"}", "legendFormat": "Loki p75", "refId": "C"},
            {"expr": "go_gc_duration_seconds{job=\"tempo\",quantile=\"0.75\"}", "legendFormat": "Tempo p75", "refId": "D"}
          ],
          "title": "GC Pause Duration",
          "type": "timeseries"
        }
      ],
      "refresh": "30s",
      "schemaVersion": 38,
      "tags": ["overview", "main", "status"],
      "time": {"from": "now-1h", "to": "now"},
      "title": "overview-main",
      "uid": "overview-main",
      "version": 2
    }
